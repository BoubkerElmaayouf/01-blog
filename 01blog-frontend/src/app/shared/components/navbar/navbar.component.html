<mat-toolbar class="navbar">
  <div class="navbar-inner">


  <!-- Left section with hamburger menu and logo -->
  <div class="navbar-left">
    <div class="logo-container">
      <a routerLink="/" class="logo">
        Cocoon
          <!-- <img src="/line_logo.svg" alt="Logo" class="logo"> -->
      </a>
    </div>
  </div>

  <!-- Center section with search -->
  <div class="navbar-center">
    <div class="search-wrapper">
      <div class="search-container">
        <mat-icon class="search-icon">search</mat-icon>
        <input 
          type="text" 
          class="search-input" 
          placeholder="Search articles and users..."
          [(ngModel)]="searchQuery"
          (input)="onSearchInput()"
          (focus)="onSearchFocus()"
          (blur)="onSearchBlur()"
          (keyup.enter)="onSearch()"
        />
        <button 
          *ngIf="searchQuery.length > 0"
          mat-icon-button 
          class="clear-search-btn"
          (click)="clearSearch()"
          type="button"
        >
          <mat-icon>close</mat-icon>
        </button>
        <mat-spinner 
          *ngIf="isSearching" 
          diameter="20" 
          class="search-spinner"
        ></mat-spinner>
      </div>

      <!-- Search Results Dropdown -->
      <div class="search-results-dropdown" *ngIf="showSearchResults">
        <div class="search-results-container">
          <!-- No Results -->
          <div *ngIf="!isSearching && searchResults.length === 0" class="search-no-results">
            <mat-icon class="no-results-icon">search_off</mat-icon>
            <span class="no-results-text">No results found for "{{ searchQuery }}"</span>
          </div>

          <!-- Search Results -->
          <div 
            *ngFor="let result of searchResults; trackBy: trackBySearchResult" 
            class="search-result-item"
            (click)="onSearchResultClick(result)"
          >
            <div class="search-result-content">
              <!-- User Avatar -->
              <div 
                class="search-result-avatar"
                (click)="onUserClick(result, $event)"
              >
                <img [src]="result.profilePic" [alt]="result.firstName + ' ' + result.lastName" />
              </div>

              <!-- Result Details -->
              <div class="search-result-details">
                <!-- User Info -->
                <div class="search-result-user"  (click)="onUserClick(result, $event)">
                  <span class="user-name">{{ result.firstName }} {{ result.lastName }}</span>
                  <span class="user-bio" *ngIf="result.bio">{{ result.bio }}</span>
                </div>

                <!-- Post Info -->
                <div class="search-result-post" (click)="onSearchResultClick(result)">
                  <h4 class="post-title" >{{ result.title }}</h4>
                  <div class="post-meta">
                    <span class="post-topic" *ngIf="result.topic">{{ result.topic }}</span>
                    <span class="post-date">{{ getTimeAgo(result.createdAt) }}</span>
                  </div>
                </div>
              </div>

              <!-- Post Banner Thumbnail -->
              <div class="search-result-thumbnail" *ngIf="result.banner">
                <img [src]="result.banner" [alt]="result.title" />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Right section with actions -->
  <div class="navbar-right">
    <a
      mat-icon-button
      class="write-button"
      aria-label="Write"
      routerLink="/write"
    >
      <mat-icon class="icons">post_add</mat-icon>
    </a>

    <span class="write-text desktop-only">Write</span>
    
    <!-- Notification Button with Menu -->
    <button 
      mat-icon-button 
      class="notification-button"
      [matMenuTriggerFor]="notificationMenu"
      aria-label="Notifications"
      (click)="onNotificationClick()"
    >
      <mat-icon [matBadge]="unreadCount > 0 ? unreadCount : null" 
                [matBadgeColor]="'warn'"
                matBadgeSize="small"
                matBadgePosition="above after">
        notifications_none
      </mat-icon>
    </button>

    <!-- Notification Menu -->
    <mat-menu #notificationMenu="matMenu" class="notification-menu" xPosition="before" yPosition="below">
      <!-- Header -->
      <div class="notification-header" mat-menu-item disabled>
        <div class="notification-title">
          <span>Notifications</span>
          <button 
            mat-icon-button 
            class="mark-all-read-btn"
            (click)="markAllAsRead(); $event.stopPropagation()"
            [disabled]="unreadCount === 0"
            matTooltip="Mark all as read"
          >
            <mat-icon>done_all</mat-icon>
          </button>
        </div>
      </div>
      
      <mat-divider class="notification-divider"></mat-divider>
      
      <!-- Notifications List -->
      <div class="notifications-container">
        <div *ngIf="notifications.length === 0" class="empty-notifications" mat-menu-item disabled>
          <div class="empty-content">
            <mat-icon class="empty-icon">notifications_none</mat-icon>
            <span>No notifications yet</span>
          </div>
        </div>
        
        <div *ngFor="let notification of notifications; trackBy: trackByNotificationId" 
             class="notification-item"
             [class.unread]="!notification.read"
             mat-menu-item
             (click)="onNotificationItemClick(notification); $event.stopPropagation()">
          
          <div class="notification-content">
            <div class="notification-avatar">
              <img [src]="notification.senderProfilePic" [alt]="notification.senderName" />
            </div>
            
            <div class="notification-details">
              <div class="notification-text">
                <strong>{{ notification.senderName }}</strong>
                <span>{{ getNotificationMessage(notification) }}</span>
              </div>
              
              <div class="notification-meta">
                <span class="notification-time">{{ getNotificationTimeAgo(notification.createdAt) }}</span>
                <button 
                  mat-icon-button 
                  class="toggle-read-btn"
                  (click)="toggleReadStatus(notification); $event.stopPropagation()"
                  [matTooltip]="notification.read ? 'Mark as unread' : 'Mark as read'"
                >
                  <mat-icon>{{ notification.read ? 'mark_email_unread' : 'mark_email_read' }}</mat-icon>
                </button>
              </div>
            </div>
            
            <div class="unread-indicator" *ngIf="!notification.read"></div>
          </div>
        </div>
      </div>
      
      <!-- View All Link -->
      <mat-divider class="notification-divider" *ngIf="notifications.length > 0"></mat-divider>
      <a mat-menu-item routerLink="/notifications" class="view-all-notifications" *ngIf="notifications.length > 0">
        <span>View all notifications</span>
        <mat-icon>arrow_forward</mat-icon>
      </a>
    </mat-menu>

    <!-- User Menu -->
    <button mat-button [matMenuTriggerFor]="userMenu" class="user-avatar">
      <img 
        [src]="userProfile?.profilePic" 
        alt="User Avatar" 
        class="avatar-image"
      />
    </button>

    <mat-menu #userMenu="matMenu" class="user-menu" xPosition="before" yPosition="below">
      <!-- User Profile Header -->
      <div class="profile-header" mat-menu-item disabled>
        <img 
          [src]="userProfile?.profilePic" 
          alt="Profile Avatar" 
          class="profile-avatar"
        />
        <div class="profile-info">
          <div class="profile-name">{{ userProfile?.firstName }} {{ userProfile?.lastName }}</div>
          <div class="profile-email">{{ userProfile?.email }}</div>
        </div>
      </div>
      
      <mat-divider class="profile-divider"></mat-divider>
      
      <a mat-menu-item routerLink="/profile" class="menu-item">
        <mat-icon>person_outline</mat-icon>
        <span>Profile</span>
      </a>

      <a mat-menu-item routerLink="/privacy-policy" class="menu-item">
        <mat-icon>description</mat-icon>
        <span>Privacy Policy</span>
      </a>

      <a mat-menu-item routerLink="/report" class="menu-item">
        <mat-icon>flag</mat-icon>
        <span>Report an issue</span>
      </a>

       <a *ngIf="isAdmin" mat-menu-item routerLink="/admin" class="menu-item">
        <mat-icon>admin_panel_settings</mat-icon>
        <span>Admin panel</span>
      </a>
      <mat-divider class="logout-divider"></mat-divider>
      
      <button mat-menu-item (click)="onLogout()" class="logout-item">
        <mat-icon>logout</mat-icon>
        <span>Logout</span>
      </button>
    </mat-menu>
  </div>
</div>

</mat-toolbar>