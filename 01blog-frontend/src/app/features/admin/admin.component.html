<div class="admin-container">
  <!-- Navbar -->
  <app-navbar></app-navbar>

  <!-- Header -->
  <mat-toolbar class="admin-header">
    <svg viewBox="0 0 120 140" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M30 20 Q20 15 15 25 Q10 35 15 45 L25 120 Q30 130 40 130 L80 130 Q90 130 95 120 L105 45 Q110 35 105 25 Q100 15 90 20" 
            stroke="black" 
            stroke-width="2.5" 
            fill="none"/>
      <path d="M25 35 Q60 30 95 35" stroke="black" stroke-width="2" fill="none"/>
      <path d="M27 50 Q60 45 93 50" stroke="black" stroke-width="2" fill="none"/>
      <path d="M29 65 Q60 60 91 65" stroke="black" stroke-width="2" fill="none"/>
      <path d="M31 80 Q60 75 89 80" stroke="black" stroke-width="2" fill="none"/>
      <path d="M33 95 Q60 90 87 95" stroke="black" stroke-width="2" fill="none"/>
      <path d="M35 110 Q60 105 85 110" stroke="black" stroke-width="2" fill="none"/>
      <path d="M60 20 Q55 10 50 5 Q45 2 40 5 Q35 8 40 12 Q45 15 50 12 Q55 8 60 12 Q65 16 70 12 Q75 8 80 12 Q85 16 90 12 Q95 8 90 5" 
            stroke="black" 
            stroke-width="2.5" 
            fill="none"/>
    </svg>
    <span class="admin-title">Cocoon Admin Panel</span>
  </mat-toolbar>

  <!-- Main Content -->
  <div class="admin-content">
    <!-- Statistics Section -->
    <div class="statistics-section">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-number">{{ totalUsers }}</div>
          <div class="stat-label">Total Users</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-number banned">{{ bannedUsers }}</div>
          <div class="stat-label">Banned Users</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-number">{{ totalPosts }}</div>
          <div class="stat-label">Total Posts</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-number pending">{{ pendingReports }}</div>
          <div class="stat-label">Pending Reports</div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Management Tabs -->
    <mat-tab-group class="management-tabs">
      <!-- Users Tab -->
      <mat-tab label="Users Management">
        <div class="tab-content">
          <!-- Search & Filter Bar -->
          <div class="filters-container">
            <div class="filter-group">
              <mat-form-field appearance="outline" class="search-field">
                <mat-label>Search by username or email</mat-label>
                <input matInput 
                       [(ngModel)]="userSearchTerm" 
                       (input)="onUserSearchChange()"
                       placeholder="e.g., john, john@email.com">
                <mat-icon matSuffix>search</mat-icon>
              </mat-form-field>

              <mat-form-field appearance="outline" class="filter-field">
                <mat-label>Filter by Status</mat-label>
                <mat-select [(ngModel)]="userStatusFilter" (selectionChange)="onUserStatusFilterChange()">
                  <mat-option value="all">All Status</mat-option>
                  <mat-option value="active">Active</mat-option>
                  <mat-option value="banned">Banned</mat-option>
                </mat-select>
              </mat-form-field>

              <button class="clear-filters-btn" (click)="clearUserFilters()">
                <mat-icon>clear</mat-icon>
                Clear Filters
              </button>
            </div>

            <div class="results-count">
              Showing {{ filteredUsers.length }} of {{ users.length }} users
            </div>
          </div>

          <!-- Users Table Card -->
          <mat-card>
            <mat-card-header>
              <mat-card-title>All Users</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="table-container">
                <table mat-table [dataSource]="filteredUsers" class="users-table">
                  <!-- ID Column -->
                  <ng-container matColumnDef="id">
                    <th mat-header-cell *matHeaderCellDef>ID</th>
                    <td mat-cell *matCellDef="let user">{{ user.id }}</td>
                  </ng-container>

                  <!-- Username Column -->
                  <ng-container matColumnDef="username">
                    <th mat-header-cell *matHeaderCellDef>Username</th>
                    <td mat-cell *matCellDef="let user" [ngClass]="{'banned-item': user.status === 'banned'}">
                      {{ user.username }}
                    </td>
                  </ng-container>

                  <!-- Email Column -->
                  <ng-container matColumnDef="email">
                    <th mat-header-cell *matHeaderCellDef>Email</th>
                    <td mat-cell *matCellDef="let user" [ngClass]="{'banned-item': user.status === 'banned'}">
                      {{ user.email }}
                    </td>
                  </ng-container>

                  <!-- Join Date Column -->
                  <ng-container matColumnDef="joinDate">
                    <th mat-header-cell *matHeaderCellDef>Join Date</th>
                    <td mat-cell *matCellDef="let user" [ngClass]="{'banned-item': user.status === 'banned'}">
                      {{ user.joinDate | date:'mediumDate' }}
                    </td>
                  </ng-container>

                  <!-- Posts Count Column -->
                  <ng-container matColumnDef="postsCount">
                    <th mat-header-cell *matHeaderCellDef>Posts</th>
                    <td mat-cell *matCellDef="let user" [ngClass]="{'banned-item': user.status === 'banned'}">
                      {{ user.postsCount }}
                    </td>
                  </ng-container>

                  <!-- Status Column -->
                  <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef>Status</th>
                    <td mat-cell *matCellDef="let user">
                      <mat-chip [ngClass]="user.status === 'banned' ? 'banned-chip' : 'active-chip'">
                        {{ user.status }}
                      </mat-chip>
                    </td>
                  </ng-container>

                  <!-- Actions Column -->
                  <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef>Actions</th>
                    <td mat-cell *matCellDef="let user" class="actions-cell">
                      <button  
                              *ngIf="user.status === 'active'" 
                              (click)="onBanManagment(user, 'banned')"
                              class="action-button ban-button">
                        <mat-icon>block</mat-icon>
                        Ban
                      </button>
                      <button  
                              *ngIf="user.status === 'banned'" 
                              (click)="onBanManagment(user, 'active')"
                              class="action-button unban-button">
                        <mat-icon>check_circle</mat-icon>
                        Unban
                      </button>
                      <button 
                              (click)="openDeleteUserDialog(user, $event)"
                              class="action-button delete-button">
                        <mat-icon>delete</mat-icon>
                        Delete
                      </button>
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="userColumns"></tr>
                  <tr mat-row *matRowDef="let row; columns: userColumns;"></tr>
                </table>

                <!-- No Results Message -->
                <div *ngIf="filteredUsers.length === 0" class="no-results">
                  <mat-icon>search_off</mat-icon>
                  <p>No users found matching your criteria</p>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Posts Tab -->
      <mat-tab label="Posts Management">
        <div class="tab-content">
          <!-- Search & Filter Bar -->
          <div class="filters-container">
            <div class="filter-group">
              <mat-form-field appearance="outline" class="search-field">
                <mat-label>Search by title or author</mat-label>
                <input matInput 
                       [(ngModel)]="postSearchTerm" 
                       (input)="onPostSearchChange()"
                       placeholder="e.g., Angular, john">
                <mat-icon matSuffix>search</mat-icon>
              </mat-form-field>

              <mat-form-field appearance="outline" class="filter-field">
                <mat-label>Filter by Status</mat-label>
                <mat-select [(ngModel)]="postStatusFilter" (selectionChange)="onPostStatusFilterChange()">
                  <mat-option value="all">All Status</mat-option>
                  <mat-option value="published">Published</mat-option>
                  <mat-option value="removed">Removed</mat-option>
                </mat-select>
              </mat-form-field>

              <button class="clear-filters-btn" (click)="clearPostFilters()">
                <mat-icon>clear</mat-icon>
                Clear Filters
              </button>
            </div>

            <div class="results-count">
              Showing {{ filteredPosts.length }} of {{ posts.length }} posts
            </div>
          </div>

          <!-- Posts Table Card -->
          <mat-card>
            <mat-card-header>
              <mat-card-title>All Posts</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="table-container">
                <table mat-table [dataSource]="filteredPosts" class="posts-table">
                  <!-- ID Column -->
                  <ng-container matColumnDef="id">
                    <th mat-header-cell *matHeaderCellDef>ID</th>
                    <td mat-cell *matCellDef="let post">{{ post.id }}</td>
                  </ng-container>

                  <!-- Title Column -->
                  <ng-container matColumnDef="title">
                    <th mat-header-cell *matHeaderCellDef>Title</th>
                    <td mat-cell *matCellDef="let post" [ngClass]="{'removed-item': post.status === 'removed'}">
                      {{ post.title }}
                    </td>
                  </ng-container>

                  <!-- Author Column -->
                  <ng-container matColumnDef="author">
                    <th mat-header-cell *matHeaderCellDef>Author</th>
                    <td mat-cell *matCellDef="let post" [ngClass]="{'removed-item': post.status === 'removed'}">
                      {{ post.author }}
                    </td>
                  </ng-container>

                  <!-- Publish Date Column -->
                  <ng-container matColumnDef="publishDate">
                    <th mat-header-cell *matHeaderCellDef>Published</th>
                    <td mat-cell *matCellDef="let post" [ngClass]="{'removed-item': post.status === 'removed'}">
                      {{ post.publishDate | date:'mediumDate' }}
                    </td>
                  </ng-container>

                  <!-- Views Column -->
                  <ng-container matColumnDef="views">
                    <th mat-header-cell *matHeaderCellDef>Views</th>
                    <td mat-cell *matCellDef="let post" [ngClass]="{'removed-item': post.status === 'removed'}">
                      {{ post.views }}
                    </td>
                  </ng-container>

                  <!-- Status Column -->
                  <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef>Status</th>
                    <td mat-cell *matCellDef="let post">
                      <mat-chip [ngClass]="post.status === 'removed' ? 'removed-chip' : 'published-chip'">
                        {{ post.status }}
                      </mat-chip>
                    </td>
                  </ng-container>

                  <!-- Actions Column -->
                  <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef>Actions</th>
                    <td mat-cell *matCellDef="let post" class="actions-cell">
                      <button 
                              (click)="openDeletePostDialog(post, $event)"
                              class="action-button delete-button">
                        <mat-icon fontSet="material-icons-outlined">delete</mat-icon>
                        Delete
                      </button>
                      <button 
                         
                        class="action-button restore-button">
                        <mat-icon fontSet="material-icons-outlined">restore_from_trash</mat-icon>
                        Hide
                      </button>

                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="postColumns"></tr>
                  <tr mat-row *matRowDef="let row; columns: postColumns;"></tr>
                </table>

                <!-- No Results Message -->
                <div *ngIf="filteredPosts.length === 0" class="no-results">
                  <mat-icon>search_off</mat-icon>
                  <p>No posts found matching your criteria</p>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Reports Tab -->
      <mat-tab label="Reports Management">
        <div class="tab-content">
          <!-- Search & Filter Bar -->
          <div class="filters-container">
            <div class="filter-group">
              <mat-form-field appearance="outline" class="search-field">
                <mat-label>Search reports</mat-label>
                <input matInput 
                       [(ngModel)]="reportSearchTerm" 
                       (input)="onReportSearchChange()"
                       placeholder="e.g., spam, john">
                <mat-icon matSuffix>search</mat-icon>
              </mat-form-field>

              <mat-form-field appearance="outline" class="filter-field">
                <mat-label>Filter by Status</mat-label>
                <mat-select [(ngModel)]="reportStatusFilter" (selectionChange)="onReportStatusFilterChange()">
                  <mat-option value="all">All Status</mat-option>
                  <mat-option value="pending">Pending</mat-option>
                  <mat-option value="resolved">Resolved</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="filter-field">
                <mat-label>Filter by Type</mat-label>
                <mat-select [(ngModel)]="reportTypeFilter" (selectionChange)="onReportTypeFilterChange()">
                  <mat-option value="all">All Types</mat-option>
                  <mat-option value="user">User</mat-option>
                  <mat-option value="post">Post</mat-option>
                </mat-select>
              </mat-form-field>

              <button class="clear-filters-btn" (click)="clearReportFilters()">
                <mat-icon>clear</mat-icon>
                Clear Filters
              </button>
            </div>

            <div class="results-count">
              Showing {{ filteredReports.length }} of {{ reports.length }} reports
            </div>
          </div>

          <!-- Reports Table Card -->
          <mat-card>
            <mat-card-header>
              <mat-card-title>User Reports</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="table-container">
                <table mat-table [dataSource]="filteredReports" class="reports-table">
                  <!-- ID Column -->
                  <ng-container matColumnDef="id">
                    <th mat-header-cell *matHeaderCellDef>ID</th>
                    <td mat-cell *matCellDef="let report">{{ report.id }}</td>
                  </ng-container>

                  <!-- Reporter Column -->
                  <ng-container matColumnDef="reporter">
                    <th mat-header-cell *matHeaderCellDef>Reporter</th>
                    <td mat-cell *matCellDef="let report">{{ report.reporterUsername }}</td>
                  </ng-container>

                  <!-- Reported Item Column -->
                  <ng-container matColumnDef="reportedItem">
                    <th mat-header-cell *matHeaderCellDef>Reported Item</th>
                    <td mat-cell *matCellDef="let report">{{ report.reportedItem }}</td>
                  </ng-container>

                  <!-- Item Type Column -->
                  <ng-container matColumnDef="itemType">
                    <th mat-header-cell *matHeaderCellDef>Type</th>
                    <td mat-cell *matCellDef="let report">
                      <mat-chip class="type-chip">{{ report.itemType }}</mat-chip>
                    </td>
                  </ng-container>

                  <!-- Reason Column -->
                  <ng-container matColumnDef="reason">
                    <th mat-header-cell *matHeaderCellDef>Reason</th>
                    <td mat-cell *matCellDef="let report" class="reason-text">{{ report.reason }}</td>
                  </ng-container>

                  <!-- Report Date Column -->
                  <ng-container matColumnDef="reportDate">
                    <th mat-header-cell *matHeaderCellDef>Reported</th>
                    <td mat-cell *matCellDef="let report">{{ report.reportDate | date:'mediumDate' }}</td>
                  </ng-container>

                  <!-- Status Column -->
                  <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef>Status</th>
                    <td mat-cell *matCellDef="let report">
                      <mat-chip [ngClass]="report.status === 'pending' ? 'pending-chip' : 'resolved-chip'">
                        {{ report.status }}
                      </mat-chip>
                    </td>
                  </ng-container>

                  <!-- Actions Column -->
                  <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef>Actions</th>
                    <td mat-cell *matCellDef="let report" class="actions-cell">
                      <button  
                              *ngIf="report.status === 'pending'" 
                              (click)="onResolveReport(report, $event)"
                              class="action-button resolve-button">
                        <mat-icon>check</mat-icon>
                        Resolve
                      </button>
                      <button  
                              (click)="openDismissReportDialog(report, $event)"
                              class="action-button dismiss-button">
                        <mat-icon>close</mat-icon>
                        Dismiss
                      </button>
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="reportColumns"></tr>
                  <tr mat-row *matRowDef="let row; columns: reportColumns;"></tr>
                </table>

                <!-- No Results Message -->
                <div *ngIf="filteredReports.length === 0" class="no-results">
                  <mat-icon>search_off</mat-icon>
                  <p>No reports found matching your criteria</p>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>

  <!-- Footer -->
  <footer class="admin-footer">
    <p>Â© Cocoon. All rights reserved.</p>
  </footer>
</div>