<app-navbar></app-navbar>
<div class="profile-container">
  <!-- Profile Header -->
  <div class="profile-header">
    <div class="profile-avatar-section">
      <div class="avatar-container">
        <img [src]="getCurrentProfilePicture()" [alt]="getFullName()" class="profile-avatar">
        <div *ngIf="isEditingProfile" class="avatar-overlay">
          <input type="file" #fileInput (change)="onFileSelected($event)" accept="image/*" style="display: none;">
          <button mat-icon-button (click)="fileInput.click()" class="change-photo-btn">
            <mat-icon>camera_alt</mat-icon>
          </button>
        </div>
      </div>
    </div>
    
    <div class="profile-info">
      <div *ngIf="!isEditingProfile" class="profile-display">
        <h1 class="profile-name">{{ getFullName() }}</h1>
        <p class="profile-email">{{ userProfile.email }}</p>
        <p class="profile-bio">{{ userProfile.bio }}</p>
        <button mat-stroked-button (click)="toggleEditProfile()" class="edit-btn">
          <mat-icon>edit</mat-icon>
          Edit Profile
        </button>
      </div>
      
      <div *ngIf="isEditingProfile" class="profile-edit">
        <form [formGroup]="profileForm">
          <div class="name-fields">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>First Name</mat-label>
              <input matInput formControlName="firstName">
              <mat-error *ngIf="profileForm.get('firstName')?.hasError('required')">
                First name is required
              </mat-error>
              <mat-error *ngIf="profileForm.get('firstName')?.hasError('minlength')">
                First name must be at least 2 characters
              </mat-error>
            </mat-form-field>
            
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Last Name</mat-label>
              <input matInput formControlName="lastName">
              <mat-error *ngIf="profileForm.get('lastName')?.hasError('required')">
                Last name is required
              </mat-error>
              <mat-error *ngIf="profileForm.get('lastName')?.hasError('minlength')">
                Last name must be at least 2 characters
              </mat-error>
            </mat-form-field>
          </div>
          
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Bio</mat-label>
            <textarea matInput formControlName="bio" rows="4" maxlength="500"></textarea>
            <mat-hint align="end">{{ profileForm.get('bio')?.value?.length || 0 }}/500</mat-hint>
            <mat-error *ngIf="profileForm.get('bio')?.hasError('maxlength')">
              Bio cannot exceed 500 characters
            </mat-error>
          </mat-form-field>
          
          <div class="form-actions">
            <button mat-button (click)="toggleEditProfile()" type="button">Cancel</button>
            <button mat-raised-button color="primary" (click)="saveProfile()" 
                    [disabled]="profileForm.invalid" type="button">
              Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Statistics -->
  <div class="statistics-section">
    <div class="stat-card">
      <span class="stat-number">{{ userProfile.statistics.blogsCount }}</span>
      <span class="stat-label">Blogs</span>
    </div>
    <div class="stat-card">
      <span class="stat-number">{{ userProfile.statistics.totalLikes }}</span>
      <span class="stat-label">Likes</span>
    </div>
    <div class="stat-card">
      <span class="stat-number">{{ userProfile.statistics.totalComments }}</span>
      <span class="stat-label">Comments</span>
    </div>
  </div>

  <!-- Password Change Section -->
  <div class="password-section">
    <div class="section-header">
      <h2>Password</h2>
      <button *ngIf="!isEditingPassword" mat-stroked-button (click)="toggleEditPassword()">
        <mat-icon>lock</mat-icon>
        Change Password
      </button>
    </div>
    
    <div *ngIf="isEditingPassword" class="password-form">
      <form [formGroup]="passwordForm">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Current Password</mat-label>
          <input matInput type="password" formControlName="currentPassword">
          <mat-error *ngIf="passwordForm.get('currentPassword')?.hasError('required')">
            Current password is required
          </mat-error>
        </mat-form-field>
        
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>New Password</mat-label>
          <input matInput type="password" formControlName="newPassword">
          <mat-error *ngIf="passwordForm.get('newPassword')?.hasError('required')">
            New password is required
          </mat-error>
          <mat-error *ngIf="passwordForm.get('newPassword')?.hasError('minlength')">
            Password must be at least 8 characters
          </mat-error>
        </mat-form-field>
        
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Confirm New Password</mat-label>
          <input matInput type="password" formControlName="confirmPassword">
          <mat-error *ngIf="passwordForm.get('confirmPassword')?.hasError('required')">
            Please confirm your password
          </mat-error>
          <mat-error *ngIf="passwordForm.get('confirmPassword')?.hasError('mismatch')">
            Passwords do not match
          </mat-error>
        </mat-form-field>
        
        <div class="form-actions">
          <button mat-button (click)="toggleEditPassword()" type="button">Cancel</button>
          <button mat-raised-button color="primary" (click)="savePassword()" 
                  [disabled]="passwordForm.invalid" type="button">
            Update Password
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- User Blogs Section -->
  <div class="blogs-section">
    <div class="section-header">
      <h2>My Blogs</h2>
      <span class="blog-count">{{ userBlogs.length }} articles</span>
    </div>
    
    <div class="blogs-grid">
      <div *ngFor="let blog of userBlogs" class="blog-card">
        <div class="blog-image" *ngIf="blog.imageUrl">
          <img [src]="blog.imageUrl" [alt]="blog.title">
        </div>
        
        <div class="blog-content">
          <h3 class="blog-title">{{ blog.title }}</h3>
          <p class="blog-excerpt">{{ blog.excerpt }}</p>
          
          <div class="blog-meta">
            <span class="blog-date">{{ formatDate(blog.publishedDate) }}</span>
            <div class="blog-stats">
              <span class="blog-stat">
                <mat-icon class="stat-icon">favorite_border</mat-icon>
                {{ blog.likes }}
              </span>
              <span class="blog-stat">
                <mat-icon class="stat-icon">comment</mat-icon>
                {{ blog.comments }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div *ngIf="userBlogs.length === 0" class="empty-state">
      <mat-icon class="empty-icon">article</mat-icon>
      <h3>No blogs yet</h3>
      <p>Start writing your first blog post to see it here.</p>
    </div>
  </div>
</div>